<?xml version="1.0" ?>
<openerp>
    <data>

        <menuitem name="Appraisal" parent="hr.menu_hr_root" id="menu_eval_hr" sequence="25"/>
        <menuitem name="Periodic Appraisal" parent="hr.menu_hr_configuration" id="menu_eval_hr_config" sequence="4"/>
        <record model="ir.ui.view" id="view_hr_evaluation_stage_form">
            <field name="name">hr_evaluation.stage.form</field>
            <field name="model">hr_evaluation.stage</field>
            <field name="arch" type="xml">
                <form string="Appraisal Stage">
                    <sheet>
	                    <group col="4">
	                        <field name="sequence"/>
	                        <field name="name"/>
	                    </group>
	                </sheet>
                </form>
            </field>
        </record>
        <record model="ir.ui.view" id="view_hr_evaluation_stage_tree">
            <field name="name">hr_evaluation.stage.form</field>
            <field name="model">hr_evaluation.stage</field>
            <field name="arch" type="xml">
                <tree string="Appraisal Stage">
                    <field name="sequence"/>
                    <field name="name"/>
                </tree>
            </field>
        </record>

         <record id="act_hr_evaluation_stage" model="ir.actions.act_window">
            <field name="res_model">hr_evaluation.stage</field>
            <field name="view_type">form</field>
            <field name="name">Appraisal Stage</field>
            <field name="view_mode">tree,form</field>
        </record>

         <menuitem name="Appraisal Stage" parent="hr.menu_hr_configuration" id="menu_hr_evaluation_stage" action="act_hr_evaluation_stage"/>

        <record model="ir.ui.view" id="view_hr_evaluation_form">
            <field name="name">hr_evaluation.evaluation.form</field>
            <field name="model">hr_evaluation.evaluation</field>
            <field name="arch" type="xml">
                <form string="Appraisal">
                <header>
                    <!--  button name="button_plan_in_progress" string="Start Appraisal" states="draft" type="object" class="oe_highlight"/>
                    <button name="button_final_validation" string="Validate Appraisal" states="wait" type="object" class="oe_highlight"/>
                    <button name="button_done" string="Done" states="progress" type="object" class="oe_highlight"/>
                    <button name="button_draft" string="Reset to Draft" states="cancel" type="object" />
                    <button name="button_cancel" string="Cancel Appraisal" states="draft,wait,progress" type="object"/>-->
                    <field name="stage_id" widget="statusbar" options="{'fold_field': 'fold'}"/>
                </header>
                <sheet>
                    <label for="employee_id" class="oe_edit_only"/>
                    <h1>
                        <field name="employee_id" class="oe_inline"  on_change="1"/>
                    </h1>
                    <group>
                        <group col="4">
                            <field name="department_id"/>
                            <field name="interview_deadline"/>
                            <field name="date_close"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Internal Note">
                            <field name="note_summary"/>
                        </page>
                        <page string="Final Evaluation">
                            <field name="evaluation"/>
                        </page>
                        <page string="Plan" attrs="{'invisible':[('appraisal_manager','=',False),('appraisal_colleagues','=',False),('appraisal_self','=',False),('appraisal_subordinates','=',False)]}">
                            <group col="4">
                                <label for="appraisal_manager" string="Send Apprasial Form To"/>
                                <group col="3">
                                    <div class="address_format" attrs="{'invisible':[('appraisal_manager','=',False)]}">
                                        <field name="appraisal_manager" invisible="1"/>
                                        <label string="Mangare"/>
                                    </div>
                                    <field name="apprasial_manager_ids" nolabel="1" widget="many2many_tags" attrs="{'invisible':[('appraisal_manager','=',False)]}"/>
                                    <field name="apprasial_manager_survey_id" nolabel="1" attrs="{'invisible':[('appraisal_manager','=',False)]}"/>
                                    <div class="address_format" attrs="{'invisible':[('appraisal_colleagues','=',False)]}">
                                        <field name="appraisal_colleagues" invisible="1"/>
                                        <label string="Colleagues"/>
                                    </div>
                                    <field name="appraisal_colleagues_ids" nolabel="1" widget="many2many_tags" attrs="{'invisible':[('appraisal_colleagues','=',False)]}"/>
                                    <field name="appraisal_colleagues_survey_id" nolabel="1" attrs="{'invisible':[('appraisal_colleagues','=',False)]}"/>
                                    <div class="address_format" attrs="{'invisible':[('appraisal_self','=',False)]}">
                                        <field name="appraisal_self" invisible="1"/>
                                        <label string="Self"/>
                                    </div>
                                    <field name="apprasial_employee_id" nolabel="1" attrs="{'invisible':[('appraisal_self','=',False)]}"/>
                                    <field name="appraisal_self_survey_id" nolabel="1" attrs="{'invisible':[('appraisal_self','=',False)]}"/>
                                    <div class="address_format" attrs="{'invisible':[('appraisal_subordinates','=',False)]}">
                                        <field name="appraisal_subordinates" invisible="1"/>
                                        <label string="Collaborator"/>
                                    </div>
                                    <field name="appraisal_subordinates_ids" nolabel="1" widget="many2many_tags" attrs="{'invisible':[('appraisal_subordinates','=',False)]}"/>
                                    <field name="appraisal_subordinates_survey_id" nolabel="1" attrs="{'invisible':[('appraisal_subordinates','=',False)]}"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                    <!--  label for="plan_id" class="oe_edit_only"/>
                    <h2><field name="plan_id" attrs="{'readonly': [('state', '=', 'done')]}"/></h2>
                    <group>
                        <group colspan="4" attrs="{'invisible':['|', ('state','=','draft'), ('state', '=', 'wait')]}">
                            <field name="rating" attrs="{'readonly':[('state','&lt;&gt;','progress')]}"/>
                            <field name="date_close" readonly="1"/>
                        </group>
                    </group>
                    <group string="Appraisal Forms" attrs="{'invisible':[('state','=','draft')]}">
                        <field nolabel="1" name="survey_request_ids" attrs="{'readonly': [('state', '=', 'done')]}" />
                    </group>
                    <group string="Internal Notes" attrs="{'invisible':[('state','=','draft')]}">
                        <field nolabel="1" name="note_action"
                            groups="base.group_hr_manager" placeholder="Appraisal Summary..."/>
                    </group>
                    <group string="Public Notes" attrs="{'invisible':[('state','=','draft')]}">
                        <field nolabel="1" name="note_summary" placeholder="Action Plan..."/>
                    </group>-->
              </sheet>
	          <div class="oe_chatter">
	              <field name="message_follower_ids" widget="mail_followers"/>
	              <field name="message_ids" widget="mail_thread"/>
	          </div>
              </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_hr_evaluation_tree">
            <field name="name">hr_evaluation.evaluation.tree</field>
            <field name="model">hr_evaluation.evaluation</field>
            <field name="arch" type="xml">
                <tree string="Appraisal">
                    <field name="employee_id" string="Name"/>
                    <field name="date_close"/>
                    <field name="interview_deadline"/>
                    <field name="stage_id"/>
                </tree>
            </field>
        </record>

       <record id="hr_evaluation.evaluation_search" model="ir.ui.view">
            <field name="name">hr_evaluation.evaluation_search</field>
            <field name="model">hr_evaluation.evaluation</field>
            <field name="arch" type="xml">
                <search string="Search Appraisal">
                    <!-- field name="date"/>
                    <filter icon="terp-check" string="Pending" domain="[('state','=','wait')]" help="Appraisal that are in Plan In Progress state"/>
                    <filter icon="terp-camera_test" string="In progress" domain="[('state','=','progress')]" help="Appraisal that are in waiting appreciation state"/>-->
                    <field name="employee_id"/>
                    <group expand='0' string='Group by...'>
                        <filter string='Employee' icon="terp-personal" domain="[]" context="{'group_by' : 'employee_id'}"/>
                        <filter string='Status' icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by' : 'stage_id'}" />
                        <!--  filter string='Plan' icon="terp-stock_align_left_24" domain="[]" context="{'group_by' : 'plan_id'}" />
                        <filter string='Appraisals Month' icon="terp-go-month" domain="[]" context="{'group_by' : 'date'}" help="Appraisals by Month" />-->
                   </group>
               </search>
            </field>
        </record>

        <record id="hr_evaluation.evaluation_kanban" model="ir.ui.view">
            <field name="name">hr_evaluation.evaluation_kanban</field>
            <field name="model">hr_evaluation.evaluation</field>
            <field name="arch" type="xml">
                <kanban default_group_by="stage_id">
                    <field name="employee_id"/>
                    <field name="department_id"/>
                    <field name="interview_deadline"/>
                    <field name="color"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card oe_kanban_global_click">
                            <div class="oe_dropdown_toggle oe_dropdown_kanban" groups="base.group_user">
                                <span class="oe_e">Ã­</span>
                                <ul class="oe_dropdown_menu">
                                    <t t-if="widget.view.is_action_enabled('edit')"><li><a type="edit">Edit...</a></li></t>
                                    <t t-if="widget.view.is_action_enabled('delete')"><li><a type="delete">Delete</a></li></t>
                                    <br/>
                                    <li><ul class="oe_kanban_colorpicker" data-field="color"/></li>
                                </ul>
                            </div>
                            <div class="oe_kanban_content">
                                <div><b><field name="employee_id"/></b></div>
                                <div>
                                    <field name="department_id"/><br/>
                                    <t t-if="record.interview_deadline.raw_value and record.interview_deadline.raw_value lt (new Date())" t-set="red">oe_kanban_text_red</t>
                                    Deadline: <span t-attf-class="#{red || ''}"><i><field name="interview_deadline"/></i></span>
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <img t-att-src="kanban_image('hr.employee', 'image_small', record.employee_id.raw_value)" t-att-title="record.employee_id.value" width="24" height="24" class="oe_kanban_avatar pull-right"/>
                                </div>
                            </div>
                            <div class="oe_clear"></div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record model="ir.actions.act_window" id="open_view_hr_evaluation_tree">
            <field name="name">Appraisal</field>
            <field name="res_model">hr_evaluation.evaluation</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form</field>
<!--             field name="search_view_id" ref="hr_evaluation.evaluation_search"/> -->
             <field name="context">{"search_default_next_month":1}</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a new appraisal.
              </p><p>
                Each employee may be assigned an Appraisal Plan. Such a plan
                defines the frequency and the way you manage your periodic
                personnel evaluation. You will be able to define steps and
                attach interviews to each step. Odoo manages all kinds of
                evaluations: bottom-up, top-down, self-evaluation and final
                evaluation by the manager.
              </p>
            </field>
        </record>

        <menuitem name="Appraisals" parent="menu_eval_hr" id="menu_open_view_hr_evaluation_tree"
            action="open_view_hr_evaluation_tree" groups="base.group_hr_user"/>

        <record model="ir.actions.act_window" id="open_view_hr_evaluation_tree2">
            <field name="name">Appraisal</field>
            <field name="res_model">hr_evaluation.evaluation</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{"search_default_employee_id": [active_id]}</field>
        </record>

        <record id="hr_hr_employee_view_form" model="ir.ui.view">
            <field name="name">hr.hr.employee.view.form</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr.view_employee_form"/>
            <field name="arch" type="xml">
            <xpath expr="//group[@name='active_group']" position="before">
                <group string="Appraisals">
                    <field name="evaluation_date"/>
                </group>
            </xpath>
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="%(open_view_hr_evaluation_tree2)d"
                    class="oe_stat_button"
                    icon="fa-sitemap"
                    type="action">
                    <field name="appraisal_count" widget="statinfo" string="Appraisals"/>
                </button>
            </xpath>
            <xpath expr="//page[@string='HR Settings']" position="after">
                <page string="Apprasial">
                    <group col="4">
                        <label for="appraisal_manager" string="Send Apprasial Form To"/>
                        <group col="3">
                            <div class="address_format">
                                <field name="appraisal_manager" on_change="1"/>
                                <label string="Mangare"/>
                            </div>
                            <field name="apprasial_manager_ids" nolabel="1" widget="many2many_tags" attrs="{'invisible':[('appraisal_manager','=',False)]}" readonly="0"/>
                            <field name="apprasial_manager_survey_id" nolabel="1" attrs="{'invisible':[('appraisal_manager','=',False)]}"/>
                            <div class="address_format">
                                <field name="appraisal_colleagues" on_change="1"/>
                                <label string="Colleagues"/>
                            </div>
                            <field name="appraisal_colleagues_ids" nolabel="1" widget="many2many_tags" attrs="{'invisible':[('appraisal_colleagues','=',False)]}" readonly="0"/>
                            <field name="appraisal_colleagues_survey_id" nolabel="1" attrs="{'invisible':[('appraisal_colleagues','=',False)]}"/>
                            <div class="address_format">
                                <field name="appraisal_self"/>
                                <label string="Self"/>
                            </div>
                            <field name="apprasial_employee_id" nolabel="1" attrs="{'invisible':[('appraisal_self','=',False)]}"/>
                            <field name="appraisal_self_survey_id" nolabel="1" attrs="{'invisible':[('appraisal_self','=',False)]}"/>
                            <div class="address_format">
                                <field name="appraisal_subordinates"/>
                                <label string="Collaborator"/>
                            </div>
                            <field name="appraisal_subordinates_ids" nolabel="1" widget="many2many_tags" attrs="{'invisible':[('appraisal_subordinates','=',False)]}"/>
                            <field name="appraisal_subordinates_survey_id" nolabel="1" attrs="{'invisible':[('appraisal_subordinates','=',False)]}"/>
                        </group>
                    </group>
                    <group col="4">
                        <label for="appraisal_repeat" string="Periodicity"/>
                        <group col="4">
                            <div>
                                <field name="appraisal_repeat" nolabel="1"/>
                                <label string="Repeat Every"/>
                            </div>
                            <field name="appraisal_repeat_number" nolabel="1"/>
                            <field name="appraisal_repeat_delay" nolabel="1"/>
                            <field name="date_from" nolabel="1"/>
                        </group>
                    </group>
                </page>
            </xpath>
            </field>
        </record>
    </data>
</openerp>
